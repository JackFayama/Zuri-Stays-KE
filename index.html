<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Zuri Stays KE - Your Home Away From Home</title>

  <!-- PWA Meta -->
  <meta name="theme-color" content="#ffffff" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="application-name" content="Zuri Stays KE" />
  <meta name="apple-mobile-web-app-title" content="Zuri Stays KE" />

  <!-- Icons -->
  <link rel="apple-touch-icon" sizes="152x152" href="icon-152x152.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="icon-192x192.png" />
  <link rel="apple-touch-icon" sizes="512x512" href="icon-512x512.png" />
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192x192.png" />
  <link rel="icon" type="image/png" sizes="512x512" href="icon-512x512.png" />

  <!-- Standard Favicon -->
<link rel="icon" type="image/png" sizes="32x32" href="icon-192x192.png">
<link rel="icon" type="image/x-icon" href="favicon.ico"> <!-- Optional if you have .ico -->

<!-- Apple Touch Icon -->
<link rel="apple-touch-icon" sizes="180x180" href="icon-192x192.png">

<!-- Android Chrome -->
<link rel="icon" type="image/png" sizes="192x192" href="icon-192x192.png">


  <!-- Manifest -->
  <link rel="manifest" href="manifest.json" />
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
    <style>
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .modal-backdrop {
            backdrop-filter: blur(4px);
        }
        
        .carousel-container {
            position: relative;
            overflow: hidden;
        }
        
        .carousel-track {
            display: flex;
            transition: transform 0.3s ease;
        }
        
        .carousel-slide {
            min-width: 100%;
            flex-shrink: 0;
        }

        /* Hide scrollbars but keep scrollability */
        .scrollable-content {
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* Internet Explorer 10+ */
        }
        
        .scrollable-content::-webkit-scrollbar {
            display: none; /* WebKit */
        }

        /* Hide main page scrollbars */
        body {
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* Internet Explorer 10+ */
        }
        
        body::-webkit-scrollbar {
            display: none; /* WebKit */
        }

        /* Modal z-index hierarchy */
        .modal-base { z-index: 1000; }
        .modal-secondary { z-index: 1100; }
        .modal-tertiary { z-index: 1200; }
        .modal-quaternary { z-index: 1300; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app"></div>

    <script>
        // Global state management
        const AppState = {
            currentUser: null,
            listings: [],
            bookings: [],
            reviews: [],
            filteredListings: [],
            searchQuery: '',
            modals: {
                auth: null,
                booking: null,
                host: false,
                bookings: false,
                review: null,
                profile: false,
                reviews: null,
                myListings: false,
                support: false,
                terms: false
            }
        };

        // Storage utilities
        const StorageKeys = {
            USERS: 'zuri_users',
            LISTINGS: 'zuri_listings',
            BOOKINGS: 'zuri_bookings',
            REVIEWS: 'zuri_reviews',
            CURRENT_USER: 'zuri_current_user'
        };

        const getStorageItem = (key) => {
            try {
                const item = localStorage.getItem(key);
                return item ? JSON.parse(item) : null;
            } catch {
                return null;
            }
        };

        const setStorageItem = (key, value) => {
            try {
                localStorage.setItem(key, JSON.stringify(value));
            } catch (error) {
                console.error('Error saving to localStorage:', error);
            }
        };

        // Countries data
        const countries = [
            { name: "Afghanistan", code: "+93" },
            { name: "Albania", code: "+355" },
            { name: "Algeria", code: "+213" },
            { name: "Andorra", code: "+376" },
            { name: "Angola", code: "+244" },
            { name: "Argentina", code: "+54" },
            { name: "Armenia", code: "+374" },
            { name: "Australia", code: "+61" },
            { name: "Austria", code: "+43" },
            { name: "Azerbaijan", code: "+994" },
            { name: "Bahrain", code: "+973" },
            { name: "Bangladesh", code: "+880" },
            { name: "Belarus", code: "+375" },
            { name: "Belgium", code: "+32" },
            { name: "Belize", code: "+501" },
            { name: "Benin", code: "+229" },
            { name: "Bhutan", code: "+975" },
            { name: "Bolivia", code: "+591" },
            { name: "Bosnia and Herzegovina", code: "+387" },
            { name: "Botswana", code: "+267" },
            { name: "Brazil", code: "+55" },
            { name: "Brunei", code: "+673" },
            { name: "Bulgaria", code: "+359" },
            { name: "Burkina Faso", code: "+226" },
            { name: "Burundi", code: "+257" },
            { name: "Cambodia", code: "+855" },
            { name: "Cameroon", code: "+237" },
            { name: "Canada", code: "+1" },
            { name: "Cape Verde", code: "+238" },
            { name: "Central African Republic", code: "+236" },
            { name: "Chad", code: "+235" },
            { name: "Chile", code: "+56" },
            { name: "China", code: "+86" },
            { name: "Colombia", code: "+57" },
            { name: "Comoros", code: "+269" },
            { name: "Congo", code: "+242" },
            { name: "Costa Rica", code: "+506" },
            { name: "Croatia", code: "+385" },
            { name: "Cuba", code: "+53" },
            { name: "Cyprus", code: "+357" },
            { name: "Czech Republic", code: "+420" },
            { name: "Denmark", code: "+45" },
            { name: "Djibouti", code: "+253" },
            { name: "Dominican Republic", code: "+1" },
            { name: "Ecuador", code: "+593" },
            { name: "Egypt", code: "+20" },
            { name: "El Salvador", code: "+503" },
            { name: "Equatorial Guinea", code: "+240" },
            { name: "Eritrea", code: "+291" },
            { name: "Estonia", code: "+372" },
            { name: "Ethiopia", code: "+251" },
            { name: "Fiji", code: "+679" },
            { name: "Finland", code: "+358" },
            { name: "France", code: "+33" },
            { name: "Gabon", code: "+241" },
            { name: "Gambia", code: "+220" },
            { name: "Georgia", code: "+995" },
            { name: "Germany", code: "+49" },
            { name: "Ghana", code: "+233" },
            { name: "Greece", code: "+30" },
            { name: "Guatemala", code: "+502" },
            { name: "Guinea", code: "+224" },
            { name: "Guinea-Bissau", code: "+245" },
            { name: "Guyana", code: "+592" },
            { name: "Haiti", code: "+509" },
            { name: "Honduras", code: "+504" },
            { name: "Hungary", code: "+36" },
            { name: "Iceland", code: "+354" },
            { name: "India", code: "+91" },
            { name: "Indonesia", code: "+62" },
            { name: "Iran", code: "+98" },
            { name: "Iraq", code: "+964" },
            { name: "Ireland", code: "+353" },
            { name: "Israel", code: "+972" },
            { name: "Italy", code: "+39" },
            { name: "Jamaica", code: "+1" },
            { name: "Japan", code: "+81" },
            { name: "Jordan", code: "+962" },
            { name: "Kazakhstan", code: "+7" },
            { name: "Kenya", code: "+254" },
            { name: "Kuwait", code: "+965" },
            { name: "Kyrgyzstan", code: "+996" },
            { name: "Laos", code: "+856" },
            { name: "Latvia", code: "+371" },
            { name: "Lebanon", code: "+961" },
            { name: "Lesotho", code: "+266" },
            { name: "Liberia", code: "+231" },
            { name: "Libya", code: "+218" },
            { name: "Lithuania", code: "+370" },
            { name: "Luxembourg", code: "+352" },
            { name: "Madagascar", code: "+261" },
            { name: "Malawi", code: "+265" },
            { name: "Malaysia", code: "+60" },
            { name: "Maldives", code: "+960" },
            { name: "Mali", code: "+223" },
            { name: "Malta", code: "+356" },
            { name: "Mauritania", code: "+222" },
            { name: "Mauritius", code: "+230" },
            { name: "Mexico", code: "+52" },
            { name: "Moldova", code: "+373" },
            { name: "Monaco", code: "+377" },
            { name: "Mongolia", code: "+976" },
            { name: "Montenegro", code: "+382" },
            { name: "Morocco", code: "+212" },
            { name: "Mozambique", code: "+258" },
            { name: "Myanmar", code: "+95" },
            { name: "Namibia", code: "+264" },
            { name: "Nepal", code: "+977" },
            { name: "Netherlands", code: "+31" },
            { name: "New Zealand", code: "+64" },
            { name: "Nicaragua", code: "+505" },
            { name: "Niger", code: "+227" },
            { name: "Nigeria", code: "+234" },
            { name: "North Korea", code: "+850" },
            { name: "Norway", code: "+47" },
            { name: "Oman", code: "+968" },
            { name: "Pakistan", code: "+92" },
            { name: "Panama", code: "+507" },
            { name: "Papua New Guinea", code: "+675" },
            { name: "Paraguay", code: "+595" },
            { name: "Peru", code: "+51" },
            { name: "Philippines", code: "+63" },
            { name: "Poland", code: "+48" },
            { name: "Portugal", code: "+351" },
            { name: "Qatar", code: "+974" },
            { name: "Romania", code: "+40" },
            { name: "Russia", code: "+7" },
            { name: "Rwanda", code: "+250" },
            { name: "Saudi Arabia", code: "+966" },
            { name: "Senegal", code: "+221" },
            { name: "Serbia", code: "+381" },
            { name: "Seychelles", code: "+248" },
            { name: "Sierra Leone", code: "+232" },
            { name: "Singapore", code: "+65" },
            { name: "Slovakia", code: "+421" },
            { name: "Slovenia", code: "+386" },
            { name: "Somalia", code: "+252" },
            { name: "South Africa", code: "+27" },
            { name: "South Korea", code: "+82" },
            { name: "South Sudan", code: "+211" },
            { name: "Spain", code: "+34" },
            { name: "Sri Lanka", code: "+94" },
            { name: "Sudan", code: "+249" },
            { name: "Suriname", code: "+597" },
            { name: "Sweden", code: "+46" },
            { name: "Switzerland", code: "+41" },
            { name: "Syria", code: "+963" },
            { name: "Taiwan", code: "+886" },
            { name: "Tajikistan", code: "+992" },
            { name: "Tanzania", code: "+255" },
            { name: "Thailand", code: "+66" },
            { name: "Togo", code: "+228" },
            { name: "Tunisia", code: "+216" },
            { name: "Turkey", code: "+90" },
            { name: "Turkmenistan", code: "+993" },
            { name: "Uganda", code: "+256" },
            { name: "Ukraine", code: "+380" },
            { name: "United Arab Emirates", code: "+971" },
            { name: "United Kingdom", code: "+44" },
            { name: "United States", code: "+1" },
            { name: "Uruguay", code: "+598" },
            { name: "Uzbekistan", code: "+998" },
            { name: "Venezuela", code: "+58" },
            { name: "Vietnam", code: "+84" },
            { name: "Yemen", code: "+967" },
            { name: "Zambia", code: "+260" },
            { name: "Zimbabwe", code: "+263" }
        ];

        // Kenya counties and subcounties
        const kenyaCounties = {
            "Baringo": ["Baringo Central", "Baringo North", "Baringo South", "Eldama Ravine", "Mogotio", "Tiaty"],
            "Bomet": ["Bomet Central", "Bomet East", "Chepalungu", "Konoin", "Sotik"],
            "Bungoma": ["Bumula", "Kabuchai", "Kanduyi", "Kimilili", "Mt. Elgon", "Sirisia", "Tongaren", "Webuye East", "Webuye West"],
            "Busia": ["Budalangi", "Butula", "Funyula", "Nambale", "Teso North", "Teso South"],
            "Elgeyo-Marakwet": ["Keiyo North", "Keiyo South", "Marakwet East", "Marakwet West"],
            "Embu": ["Manyatta", "Mbeere North", "Mbeere South", "Runyenjes"],
            "Garissa": ["Balambala", "Dadaab", "Fafi", "Garissa Township", "Ijara", "Lagdera"],
            "Homa Bay": ["Homa Bay Town", "Kabondo Kasipul", "Karachuonyo", "Kasipul", "Mbita", "Ndhiwa", "Rangwe", "Suba"],
            "Isiolo": ["Isiolo North", "Isiolo South"],
            "Kajiado": ["Kajiado Central", "Kajiado East", "Kajiado North", "Kajiado South", "Kajiado West"],
            "Kakamega": ["Butere", "Kakamega Central", "Kakamega East", "Kakamega North", "Kakamega South", "Khwisero", "Lugari", "Lukuyani", "Lurambi", "Matete", "Mumias East", "Mumias West", "Navakholo"],
            "Kericho": ["Ainamoi", "Belgut", "Bureti", "Kipkelion East", "Kipkelion West", "Soin/Sigowet"],
            "Kiambu": ["Gatundu North", "Gatundu South", "Githunguri", "Juja", "Kabete", "Kiambaa", "Kiambu", "Kikuyu", "Limuru", "Ruiru", "Thika Town"],
            "Kilifi": ["Ganze", "Kaloleni", "Kilifi North", "Kilifi South", "Magarini", "Malindi", "Rabai"],
            "Kirinyaga": ["Kirinyaga Central", "Kirinyaga East", "Kirinyaga West", "Mwea"],
            "Kisii": ["Bobasi", "Bomachoge Borabu", "Bomachoge Chache", "Bonchari", "Kitutu Chache North", "Kitutu Chache South", "Nyaribari Chache", "Nyaribari Masaba", "South Mugirango"],
            "Kisumu": ["Kisumu Central", "Kisumu East", "Kisumu West", "Muhoroni", "Nyakach", "Nyando", "Seme"],
            "Kitui": ["Kitui Central", "Kitui East", "Kitui Rural", "Kitui South", "Kitui West", "Mwingi Central", "Mwingi North", "Mwingi West"],
            "Kwale": ["Kinango", "Lungalunga", "Matuga", "Msambweni"],
            "Laikipia": ["Laikipia East", "Laikipia North", "Laikipia West"],
            "Lamu": ["Lamu East", "Lamu West"],
            "Machakos": ["Kathiani", "Machakos Town", "Masinga", "Matungulu", "Mavoko", "Mwala", "Yatta"],
            "Makueni": ["Kaiti", "Kibwezi East", "Kibwezi West", "Kilome", "Makueni", "Mbooni"],
            "Mandera": ["Banissa", "Lafey", "Mandera East", "Mandera North", "Mandera South", "Mandera West"],
            "Marsabit": ["Laisamis", "Moyale", "North Horr", "Saku"],
            "Meru": ["Buuri", "Igembe Central", "Igembe North", "Igembe South", "Imenti Central", "Imenti North", "Imenti South", "Tigania East", "Tigania West"],
            "Migori": ["Awendo", "Kuria East", "Kuria West", "Mabera", "Ntimaru", "Rongo", "Suna East", "Suna West", "Uriri"],
            "Mombasa": ["Changamwe", "Jomba", "Kisauni", "Likoni", "Mvita", "Nyali"],
            "Murang'a": ["Gatanga", "Kahuro", "Kandara", "Kangema", "Kigumo", "Kiharu", "Mathioya", "Murang'a South"],
            "Nairobi": ["Dagoretti North", "Dagoretti South", "Embakasi Central", "Embakasi East", "Embakasi North", "Embakasi South", "Embakasi West", "Kamukunji", "Kasarani", "Kibra", "Lang'ata", "Makadara", "Mathare", "Roysambu", "Ruaraka", "Starehe", "Westlands"],
            "Nakuru": ["Bahati", "Gilgil", "Kuresoi North", "Kuresoi South", "Molo", "Naivasha", "Nakuru Town East", "Nakuru Town West", "Njoro", "Rongai", "Subukia"],
            "Nandi": ["Aldai", "Chesumei", "Emgwen", "Mosop", "Nandi Hills", "Tinderet"],
            "Narok": ["Narok East", "Narok North", "Narok South", "Narok West", "Transmara East", "Transmara West"],
            "Nyamira": ["Borabu", "Manga", "Masaba North", "Nyamira North", "Nyamira South"],
            "Nyandarua": ["Kinangop", "Kipipiri", "Ndaragwa", "Ol Joro Oirowa", "Ol Kalou"],
            "Nyeri": ["Kieni", "Mathira", "Mukurweini", "Nyeri Town", "Othaya", "Tetu"],
            "Samburu": ["Samburu Central", "Samburu East", "Samburu North"],
            "Siaya": ["Alego Usonga", "Bondo", "Gem", "Rarieda", "Ugenya", "Ugunja"],
            "Taita-Taveta": ["Mwatate", "Taveta", "Voi", "Wundanyi"],
            "Tana River": ["Bura", "Galole", "Garsen"],
            "Tharaka-Nithi": ["Chuka/Igambang'ombe", "Maara", "Tharaka"],
            "Trans Nzoia": ["Cherangany", "Endebess", "Kiminini", "Kwanza", "Saboti"],
            "Turkana": ["Loima", "Turkana Central", "Turkana East", "Turkana North", "Turkana South", "Turkana West"],
            "Uasin Gishu": ["Ainabkoi", "Kapseret", "Kesses", "Moiben", "Soy", "Turbo"],
            "Vihiga": ["Emuhaya", "Hamisi", "Luanda", "Sabatia", "Vihiga"],
            "Wajir": ["Eldas", "Tarbaj", "Wajir East", "Wajir North", "Wajir South", "Wajir West"],
            "West Pokot": ["Kacheliba", "Kapenguria", "Pokot South", "West Pokot"]
        };

        // Currency conversion
        const USD_TO_KES_RATE = 150;

        const convertUSDToKES = async (usdAmount) => {
            try {
                const response = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
                const data = await response.json();
                const rate = data.rates.KES || USD_TO_KES_RATE;
                return Math.round(usdAmount * rate);
            } catch {
                return Math.round(usdAmount * USD_TO_KES_RATE);
            }
        };

        const formatCurrency = (amount, currency) => {
            const formatter = new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: currency,
                minimumFractionDigits: 0,
                maximumFractionDigits: 0,
            });
            return formatter.format(amount);
        };

        // Validation utilities
        const validateEmail = (email) => {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        };

        const validatePassword = (password) => {
            return password.length >= 6;
        };

        const validateTransactionId = (transactionId) => {
            const pattern = /^TG4[A-Z0-9]{7}$/i;
            return pattern.test(transactionId);
        };

        // Email service
        const sendBookingConfirmation = async (bookingData) => {
            try {
                await emailjs.send(
                    'service_rql9o4s',
                    'template_pg1pvjb',
                    {
                        to_name: 'Zuri Stays Admin',
                        from_name: bookingData.userName,
                        user_email: bookingData.userEmail,
                        listing_name: bookingData.listingName,
                        check_in: bookingData.checkIn,
                        check_out: bookingData.checkOut,
                        total_usd: bookingData.totalUSD,
                        total_kes: bookingData.totalKES,
                        transaction_id: bookingData.transactionId,
                    },
                    'W0Zng8g6Zol6lMWU9'
                );
                return true;
            } catch (error) {
                console.error('Email send failed:', error);
                return false;
            }
        };

        const sendUserRegistration = async (userData) => {
            try {
                await emailjs.send(
                    'service_rql9o4s',
                    'template_peg3eqo',
                    {
                        user_name: userData.name,
                        user_email: userData.email,
                        user_country: userData.country,
                        user_phone: userData.phone,
                        registration_date: new Date().toLocaleDateString()
                    },
                    'W0Zng8g6Zol6lMWU9'
                );
                return true;
            } catch (error) {
                console.error('User registration email failed:', error);
                return false;
            }
        };

        // Initialize storage with sample data
        const initializeStorage = () => {
            if (!getStorageItem(StorageKeys.LISTINGS)) {
                const sampleListings = [
  {
    id: '1',
    name: 'Executive 1 Bedroom in Kilimani',
    location: 'Lenana Road, Nairobi',
    price: 38,
    images: ['a1.png', 'a2.png', 'a3.png', 'a4.png', 'a5.png', 'a6.png', 'a7.png', 'a8.png', 'a9.png', 'a10.png', 'a11.png', 'a12.png', 'a13.png', 'a14.png', 'a15.png', 'a16.png', 'a17.png', 'a18.png'],
    features: ['1bedroom', 'kitchen', 'wifi', 'netflix', 'shower', 'parking', 'gym'],
    hostId: '1',
    hostName: 'Juliet Mumbu',
    hostProfilePicture: 'p1.jpg',
    description: 'Beautiful modern apartment with stunning city views',
    status: 'active',
    averageRating: 4.8,
    totalReviews: 38
  },
  {
    id: '2',
    name: 'Modern 1 Bedroom in Kileleshwa',
    location: 'Othaya Road, Nairobi',
    price: 35,
    images: ['b1.png', 'b2.png', 'b3.png', 'b4.png', 'b5.png', 'b6.png', 'b7.png', 'b8.png', 'b9.png', 'b10.png', 'b11.png', 'b12.png', 'b13.png', 'b14.png'],
    features: ['1bedroom', 'kitchen', 'wifi', 'shower', 'netflix', 'parking', 'swimming pool'],
    hostId: '2',
    hostName: 'Ann Mwikali',
    hostProfilePicture: 'p4.jpg',
    description: 'Perfect for couples and solo travelers',
    status: 'active',
    averageRating: 4.4,
    totalReviews: 12
  },
  {
    id: '3',
    name: 'Stylish 1Bedroom in Lovington',
    location: 'Lovington Mall, Nairobi',
    price: 33,
    images: ['c0.png', 'c1.png', 'c2.png', 'c3.png', 'c4.png', 'c5.png', 'c6.png', 'c8.png', 'c9.png', 'c10.png', 'c11.png', 'c12.png', 'c13.png', 'c14.png', 'c15.png', 'c16.png', 'c18.png', 'c19.png', 'c20.png'],
    features: ['1bedroom', 'kitchen', 'wifi', 'gym', 'balcony', 'dining area'],
    hostId: '3',
    hostName: 'James Mukeu',
    hostProfilePicture: 'p20.jpg',
    description: 'Stylish 1Bedroom with premium amenities',
    status: 'active',
    averageRating: 4.0,
    totalReviews: 18
  },
  {
    id: '4',
    name: 'Modern 1Bedroom in Kilimani',
    location: 'Ring Road, Nairobi',
    price: 40,
    images: ['d1.png', 'd2.png', 'd3.png', 'd4.png', 'd5.png', 'd6.png', 'd7.png', 'd8.png', 'd9.png', 'd10.png', 'd11.png', 'd12.png', 'd13.png', 'd14.png', 'd15.png', 'd16.png', 'd17.png', 'd18.png', 'd21.png', 'd22.png', 'd23.png', 'd24.png', 'd25.png', 'd26.png', 'd27.png', 'd28.png'],
    features: ['1bedroom', 'kitchen', 'wifi', 'tv', 'shower', 'parking', 'dining area', 'balcony', 'gym', 'laundry area'],
    hostId: '4',
    hostName: 'Belinda Naliaka',
    hostProfilePicture: 'p21.jpg',
    description: 'Modern 1Bedroom in the heart of Lenana Road, Kilimani',
    status: 'active',
    averageRating: 4.1,
    totalReviews: 10
  },
  {
    id: '5',
    name: 'Luxury 1Bedroom in Kilimani',
    location: 'Upper Hill Estate, Nairobi',
    price: 35,
    images: ['e1.png', 'e2.png', 'e3.png', 'e4.png', 'e5.png', 'e6.png', 'e7.png', 'e8.png', 'e9.png', 'e10.png', 'e11.png', 'e12.png', 'e13.png', 'e14.png', 'e15.png', 'e16.png', 'e17.png', 'e18.png', 'e21.png', 'e22.png', 'e23.png', 'e24.png'],
    features: ['1bedroom', 'kitchen', 'air conditioning', 'hot shower', 'swimming pool', 'gym', 'free parking', 'laundry', 'wifi'],
    hostId: '5',
    hostName: 'Hudson Baraka',
    hostProfilePicture: 'p22.jpg',
    description: 'Modern Chic spacious 1Bedroom',
    status: 'active',
    averageRating: 0.0,
    totalReviews: 0
  },
  {
    id: '6',
    name: '1Bedroom Paradise in Lovington',
    location: 'Maziwa Road, Nairobi',
    price: 30,
    images: ['f1.png', 'f2.png', 'f3.png', 'f5.png', 'f6.png', 'f7.png', 'f8.png', 'f9.png', 'f10.png', 'f11.png', 'f12.png', 'f13.png', 'f14.png', 'f15.png', 'f16.png', 'f17.png', 'f18.png', 'f21.png', 'f22.png', 'f23.png', 'f24.png'],
    features: ['1bedroom', 'kitchen', 'shower', 'free parking', 'laundry', 'wifi'],
    hostId: '6',
    hostName: 'Samuel Mogaka',
    hostProfilePicture: 'p23.jpg',
    description: 'Kick back and relax in this calm, stylish space.',
    status: 'active',
    averageRating: 4.0,
    totalReviews: 2
  }
];

                setStorageItem(StorageKeys.LISTINGS, sampleListings);
            }

            if (!getStorageItem(StorageKeys.REVIEWS)) {
                const sampleReviews = [
                    {
    id: '16',
    userId: 'kenya13',
    listingId: '1',
    bookingId: 'bk16',
    rating: 5,
    comment: 'Stylish, clean, and super comfortable. Perfect for a city escape.',
    createdAt: '2024-11-02',
    userName: 'Mercy Radebe'
},
{
    id: '17',
    userId: 'tanzania14',
    listingId: '1',
    bookingId: 'bk17',
    rating: 5,
    comment: 'Excellent communication and beautiful apartment. Felt at home.',
    createdAt: '2024-11-05',
    userName: 'Erick Mlay'
},
{
    id: '18',
    userId: 'usa15',
    listingId: '1',
    bookingId: 'bk18',
    rating: 5,
    comment: 'Everything was smooth and professional. Will book again.',
    createdAt: '2024-11-09',
    userName: 'Chloe Bennett'
},
{
    id: '19',
    userId: 'kenya16',
    listingId: '1',
    bookingId: 'bk19',
    rating: 5,
    comment: 'Perfectly located and very clean. Ideal for business trips.',
    createdAt: '2024-11-13',
    userName: 'Peter Kimani'
},
{
    id: '20',
    userId: 'tanzania17',
    listingId: '1',
    bookingId: 'bk20',
    rating: 5,
    comment: 'Host was amazing. The apartment exceeded expectations.',
    createdAt: '2024-11-16',
    userName: 'Asha Juma'
},
{
    id: '21',
    userId: 'usa18',
    listingId: '1',
    bookingId: 'bk21',
    rating: 5,
    comment: 'Very professional host. The unit was modern and spotless.',
    createdAt: '2024-11-20',
    userName: 'Jacob Anthonio'
},
{
    id: '22',
    userId: 'kenya19',
    listingId: '1',
    bookingId: 'bk22',
    rating: 5,
    comment: 'Luxury feel and super peaceful. Great stay in Kilimani.',
    createdAt: '2024-11-24',
    userName: 'Gladys Njoki'
},
{
    id: '23',
    userId: 'tanzania20',
    listingId: '1',
    bookingId: 'bk23',
    rating: 5,
    comment: 'Loved every detail. The balcony view was a plus.',
    createdAt: '2024-11-28',
    userName: 'Abdallah Salum'
},
{
    id: '24',
    userId: 'usa21',
    listingId: '1',
    bookingId: 'bk24',
    rating: 5,
    comment: 'Fantastic apartment in a prime location. Felt very safe.',
    createdAt: '2024-12-02',
    userName: 'Rebecca Sanders'
},
{
    id: '25',
    userId: 'kenya22',
    listingId: '1',
    bookingId: 'bk25',
    rating: 5,
    comment: 'Great experience. Very clean, quiet, and well-equipped.',
    createdAt: '2024-12-06',
    userName: 'Collins Mwangi'
},
{
    id: '26',
    userId: 'tanzania23',
    listingId: '1',
    bookingId: 'bk26',
    rating: 5,
    comment: 'Amazing hospitality. Will recommend to my friends.',
    createdAt: '2024-12-09',
    userName: 'Esther Nyoni'
},
{
    id: '27',
    userId: 'usa24',
    listingId: '1',
    bookingId: 'bk27',
    rating: 5,
    comment: 'Clean, secure, and well-located. Exactly what I needed.',
    createdAt: '2024-12-13',
    userName: 'James Hedwick'
},
{
    id: '28',
    userId: 'kenya25',
    listingId: '1',
    bookingId: 'bk28',
    rating: 5,
    comment: 'High-end furnishings and quiet environment. Great stay.',
    createdAt: '2024-12-17',
    userName: 'Miriam Achieng'
},
{
    id: '29',
    userId: 'tanzania26',
    listingId: '1',
    bookingId: 'bk29',
    rating: 5,
    comment: 'Super organized host and very responsive.',
    createdAt: '2024-12-21',
    userName: 'Steven Mangula'
},
{
    id: '30',
    userId: 'usa27',
    listingId: '1',
    bookingId: 'bk30',
    rating: 5,
    comment: 'The place was neat, luxurious, and just as described.',
    createdAt: '2024-12-25',
    userName: 'Sarah Mitchell'
},
{
    id: '31',
    userId: 'kenya28',
    listingId: '1',
    bookingId: 'bk31',
    rating: 5,
    comment: 'Top-notch apartment. Highly recommend for long stays.',
    createdAt: '2025-01-02',
    userName: 'George Muriuki'
},
{
    id: '32',
    userId: 'tanzania29',
    listingId: '1',
    bookingId: 'bk32',
    rating: 5,
    comment: 'Peaceful, clean, and well lit. Loved it.',
    createdAt: '2025-01-06',
    userName: 'Rukia Hassan'
},
{
    id: '33',
    userId: 'usa30',
    listingId: '1',
    bookingId: 'bk33',
    rating: 5,
    comment: 'Felt more like home than a rental. 10/10.',
    createdAt: '2025-01-10',
    userName: 'Kyle Anderson'
},
{
    id: '34',
    userId: 'kenya31',
    listingId: '1',
    bookingId: 'bk34',
    rating: 5,
    comment: 'All appliances worked perfectly. Very modern space.',
    createdAt: '2025-01-15',
    userName: 'Teresia Mutua'
},
{
    id: '35',
    userId: 'tanzania32',
    listingId: '1',
    bookingId: 'bk35',
    rating: 5,
    comment: 'Comfortable and stylish. Enjoyed the balcony views.',
    createdAt: '2025-01-20',
    userName: 'Kelvin Mussa'
},
{
    id: '36',
    userId: 'usa33',
    listingId: '1',
    bookingId: 'bk36',
    rating: 5,
    comment: 'Truly executive. The photos don’t even do it justice.',
    createdAt: '2025-01-24',
    userName: 'Brittany Tiffany'
},
{
    id: '37',
    userId: 'kenya34',
    listingId: '1',
    bookingId: 'bk37',
    rating: 5,
    comment: 'Safe and central location. Host was helpful and polite.',
    createdAt: '2025-01-28',
    userName: 'Dennis Wachira'
},
{
    id: '38',
    userId: 'tanzania35',
    listingId: '1',
    bookingId: 'bk38',
    rating: 5,
    comment: 'Loved how quiet and secure the building was.',
    createdAt: '2025-02-02',
    userName: 'Lucy Mtui'
},
{
    id: '39',
    userId: 'usa36',
    listingId: '1',
    bookingId: 'bk39',
    rating: 5,
    comment: 'Exceptional hospitality and well-thought-out space.',
    createdAt: '2025-02-06',
    userName: 'Brandon Moore'
},
{
    id: '40',
    userId: 'kenya37',
    listingId: '1',
    bookingId: 'bk40',
    rating: 5,
    comment: 'This place is a hidden gem. Very clean and classy.',
    createdAt: '2025-02-11',
    userName: 'Caroline Gathoni'
},
{
    id: '41',
    userId: 'tanzania38',
    listingId: '1',
    bookingId: 'bk41',
    rating: 5,
    comment: 'Booked for work travel. Quiet and convenient.',
    createdAt: '2025-02-15',
    userName: 'Hussein Ally'
},
{
    id: '42',
    userId: 'usa39',
    listingId: '1',
    bookingId: 'bk42',
    rating: 5,
    comment: 'Great stay. Impeccable service and sparkling clean.',
    createdAt: '2025-02-20',
    userName: 'Jennifer Theo'
},
{
    id: '43',
    userId: 'kenya40',
    listingId: '1',
    bookingId: 'bk43',
    rating: 5,
    comment: 'Loved the space and location. Kilimani is the best.',
    createdAt: '2025-02-25',
    userName: 'Paul Ndungu'
},
{
    id: '44',
    userId: 'tanzania41',
    listingId: '1',
    bookingId: 'bk44',
    rating: 5,
    comment: 'Smooth check-in, elegant space, amazing host.',
    createdAt: '2025-03-01',
    userName: 'Janeth Mbaga'
},
{
    id: '45',
    userId: 'usa42',
    listingId: '1',
    bookingId: 'bk45',
    rating: 5,
    comment: 'Everything was top-notch. Will definitely return.',
    createdAt: '2025-03-06',
    userName: 'William Thomson'
},
{
    id: '46',
    userId: 'kenya43',
    listingId: '1',
    bookingId: 'bk46',
    rating: 5,
    comment: 'Bright, airy, and exactly like the pictures.',
    createdAt: '2025-03-10',
    userName: 'Lucy Aoko'
},
{
    id: '47',
    userId: 'tanzania44',
    listingId: '1',
    bookingId: 'bk47',
    rating: 5,
    comment: 'Loved the decor and peaceful ambiance.',
    createdAt: '2025-03-14',
    userName: 'Ismail Baraka'
},
{
    id: '48',
    userId: 'usa45',
    listingId: '1',
    bookingId: 'bk48',
    rating: 5,
    comment: 'Easy access, beautiful space, great service.',
    createdAt: '2025-03-19',
    userName: 'Laura Waprick'
},
{
    id: '49',
    userId: 'kenya46',
    listingId: '1',
    bookingId: 'bk49',
    rating: 5,
    comment: 'Modern, spacious and super clean.',
    createdAt: '2025-03-23',
    userName: 'Evans Kibet'
},
{
    id: '50',
    userId: 'tanzania47',
    listingId: '1',
    bookingId: 'bk50',
    rating: 5,
    comment: 'The apartment had everything I needed and more.',
    createdAt: '2025-03-28',
    userName: 'Zainabu Kondo'
},
{
    id: '51',
    userId: 'usa48',
    listingId: '1',
    bookingId: 'bk51',
    rating: 5,
    comment: 'Professional hosting and top-tier cleanliness.',
    createdAt: '2025-04-02',
    userName: 'Adam Clark'
},
{
    id: '52',
    userId: 'kenya49',
    listingId: '1',
    bookingId: 'bk52',
    rating: 5,
    comment: 'Easy check-in, quiet neighborhood, fast WiFi.',
    createdAt: '2025-04-07',
    userName: 'Naomi Chege'
},
{
    id: '53',
    userId: 'tanzania50',
    listingId: '1',
    bookingId: 'bk53',
    rating: 5,
    comment: 'Peaceful retreat with everything nearby.',
    createdAt: '2025-04-12',
    userName: 'Said Mussa'
},
                    {
    id: '4',
    userId: 'kenya01',
    listingId: '2',
    bookingId: 'bk4',
    rating: 5,
    comment: 'Absolutely wonderful stay. The space was clean and quiet. Highly recommend!',
    createdAt: '2024-02-01',
    userName: 'Faith Wanjiru'
},
{
    id: '5',
    userId: 'tanzania02',
    listingId: '2',
    bookingId: 'bk5',
    rating: 5,
    comment: 'Fantastic host and beautiful apartment. Everything exceeded expectations.',
    createdAt: '2024-02-03',
    userName: 'Joseph Mbwana'
},
{
    id: '6',
    userId: 'usa03',
    listingId: '2',
    bookingId: 'bk6',
    rating: 5,
    comment: 'Great value for money. The location was ideal and the host was very responsive.',
    createdAt: '2024-02-05',
    userName: 'Ashley Cooper'
},
{
    id: '7',
    userId: 'kenya04',
    listingId: '2',
    bookingId: 'bk7',
    rating: 4,
    comment: 'Very nice and cozy place. Had a slight issue with hot water but resolved fast.',
    createdAt: '2024-02-07',
    userName: 'Brian Otieno'
},
{
    id: '8',
    userId: 'tanzania05',
    listingId: '2',
    bookingId: 'bk8',
    rating: 5,
    comment: 'Super clean, safe and peaceful. I really enjoyed my time here.',
    createdAt: '2024-02-09',
    userName: 'Neema Said'
},
{
    id: '9',
    userId: 'usa06',
    listingId: '2',
    bookingId: 'bk9',
    rating: 5,
    comment: 'Everything was just perfect. Loved the interior design and comfort.',
    createdAt: '2024-02-11',
    userName: 'Daniel Green'
},
{
    id: '10',
    userId: 'kenya07',
    listingId: '2',
    bookingId: 'bk10',
    rating: 5,
    comment: 'Exactly as shown in pictures. Great communication from host.',
    createdAt: '2024-02-13',
    userName: 'Linet Mwende'
},
{
    id: '11',
    userId: 'tanzania08',
    listingId: '2',
    bookingId: 'bk11',
    rating: 4,
    comment: 'Nice and quiet neighborhood. Minor delay at check-in but no big deal.',
    createdAt: '2024-02-15',
    userName: 'Hamisi Kweka'
},
{
    id: '12',
    userId: 'usa09',
    listingId: '2',
    bookingId: 'bk12',
    rating: 5,
    comment: 'Loved my stay. Will definitely book again next time I’m in town.',
    createdAt: '2024-02-17',
    userName: 'Emily Turner'
},
{
    id: '13',
    userId: 'kenya10',
    listingId: '2',
    bookingId: 'bk13',
    rating: 5,
    comment: 'Top-notch service and very clean space. Totally worth it.',
    createdAt: '2024-02-19',
    userName: 'David Njoroge'
},
{
    id: '14',
    userId: 'tanzania11',
    listingId: '2',
    bookingId: 'bk14',
    rating: 5,
    comment: 'The host was helpful and friendly. The place was spotless.',
    createdAt: '2024-02-21',
    userName: 'Janet Mwakalinga'
},
{
    id: '15',
    userId: 'usa12',
    listingId: '2',
    bookingId: 'bk15',
    rating: 5,
    comment: 'Highly recommend. Safe, stylish, and well-located.',
    createdAt: '2024-02-23',
    userName: 'Michael Harris'
},
{
    id: '101',
    userId: 'uganda01',
    listingId: '3',
    bookingId: 'bk101',
    rating: 4,
    comment: 'Nice apartment overall. Quiet and clean, but Wi-Fi could be faster.',
    createdAt: '2024-05-08',
    userName: 'Agnes Namatovu'
},
{
    id: '102',
    userId: 'china01',
    listingId: '3',
    bookingId: 'bk102',
    rating: 4,
    comment: 'Good location and safe neighborhood. Kitchen was a bit small.',
    createdAt: '2024-05-18',
    userName: 'Wei Zhang'
},
{
    id: '103',
    userId: 'ethiopia01',
    listingId: '3',
    bookingId: 'bk103',
    rating: 4,
    comment: 'Comfortable place with great lighting. Parking was a bit tight.',
    createdAt: '2024-06-01',
    userName: 'Abel Getachew'
},
{
    id: '104',
    userId: 'kenya56',
    listingId: '3',
    bookingId: 'bk104',
    rating: 4,
    comment: 'Loved the balcony space. Water pressure in the shower was low.',
    createdAt: '2024-06-14',
    userName: 'Gloria Nyaboke'
},
{
    id: '105',
    userId: 'tanzania51',
    listingId: '3',
    bookingId: 'bk105',
    rating: 4,
    comment: 'Very cozy and peaceful. Mattress could be firmer.',
    createdAt: '2024-07-03',
    userName: 'Hamisi Rajabu'
},
{
    id: '106',
    userId: 'usa52',
    listingId: '3',
    bookingId: 'bk106',
    rating: 4,
    comment: 'Clean and secure apartment. A few utensils were missing.',
    createdAt: '2024-08-10',
    userName: 'Natalie Brooks'
},
{
    id: '107',
    userId: 'uganda02',
    listingId: '3',
    bookingId: 'bk107',
    rating: 4,
    comment: 'Nice host, prompt responses. A/C was a bit noisy.',
    createdAt: '2024-09-22',
    userName: 'Brian Musoke'
},
{
    id: '108',
    userId: 'china02',
    listingId: '3',
    bookingId: 'bk108',
    rating: 4,
    comment: 'Modern design and safe area. Kitchen tools need upgrading.',
    createdAt: '2024-10-05',
    userName: 'Liu Wen'
},
{
    id: '109',
    userId: 'ethiopia02',
    listingId: '3',
    bookingId: 'bk109',
    rating: 4,
    comment: 'The location is excellent. Sofa was a bit worn.',
    createdAt: '2024-11-14',
    userName: 'Senait Kebede'
},
{
    id: '110',
    userId: 'kenya57',
    listingId: '3',
    bookingId: 'bk110',
    rating: 4,
    comment: 'Affordable and well-furnished. Had to call for extra towels.',
    createdAt: '2024-12-01',
    userName: 'Vincent Kiptoo'
},
{
    id: '111',
    userId: 'tanzania52',
    listingId: '3',
    bookingId: 'bk111',
    rating: 4,
    comment: 'Loved the location. Curtains didn’t block out much light.',
    createdAt: '2025-01-16',
    userName: 'Rehema Shayo'
},
{
    id: '112',
    userId: 'usa53',
    listingId: '3',
    bookingId: 'bk112',
    rating: 4,
    comment: 'Very good value for money. Could use more power outlets.',
    createdAt: '2025-02-10',
    userName: 'Gregory Lane'
},
{
    id: '113',
    userId: 'uganda03',
    listingId: '3',
    bookingId: 'bk113',
    rating: 4,
    comment: 'Easy check-in and great area. Found a few ants in the kitchen.',
    createdAt: '2025-03-04',
    userName: 'Joan Adoch'
},
{
    id: '114',
    userId: 'china03',
    listingId: '3',
    bookingId: 'bk114',
    rating: 4,
    comment: 'Nice environment and quiet nights. Water heater was slow.',
    createdAt: '2025-03-25',
    userName: 'Chen Hao'
},
{
    id: '115',
    userId: 'ethiopia03',
    listingId: '3',
    bookingId: 'bk115',
    rating: 4,
    comment: 'Modern layout and comfy bed. Had to wait for check-in.',
    createdAt: '2025-04-11',
    userName: 'Tigist Mekonnen'
},
{
    id: '116',
    userId: 'kenya58',
    listingId: '3',
    bookingId: 'bk116',
    rating: 4,
    comment: 'Stylish decor and quiet building. Gate remote failed once.',
    createdAt: '2025-05-07',
    userName: 'Rose Wanjiru'
},
{
    id: '117',
    userId: 'tanzania53',
    listingId: '3',
    bookingId: 'bk117',
    rating: 4,
    comment: 'Host was friendly and responsive. Room lighting a bit dim.',
    createdAt: '2025-06-08',
    userName: 'Moses Maganga'
},
{
    id: '118',
    userId: 'usa54',
    listingId: '3',
    bookingId: 'bk118',
    rating: 4,
    comment: 'Comfortable stay. Would be perfect with a stronger shower.',
    createdAt: '2025-07-04',
    userName: 'Rachel Simmons'
},
{
    id: '201',
    userId: 'kenya60',
    listingId: '4',
    bookingId: 'bk201',
    rating: 5,
    comment: 'Very elegant and clean apartment. Loved the peaceful neighborhood.',
    createdAt: '2024-10-04',
    userName: 'Linet Wambui'
},
{
    id: '202',
    userId: 'kenya61',
    listingId: '4',
    bookingId: 'bk202',
    rating: 5,
    comment: 'Exceptional service and beautiful space. Will return for sure.',
    createdAt: '2024-11-10',
    userName: 'Brian Gikonyo'
},
{
    id: '203',
    userId: 'kenya62',
    listingId: '4',
    bookingId: 'bk203',
    rating: 5,
    comment: 'Great location, modern decor, and very secure. Highly recommend.',
    createdAt: '2024-12-05',
    userName: 'Nancy Chebet'
},
{
    id: '204',
    userId: 'kenya63',
    listingId: '4',
    bookingId: 'bk204',
    rating: 5,
    comment: 'Everything was clean and well maintained. Host was very polite.',
    createdAt: '2025-01-09',
    userName: 'Kevin Otieno'
},
{
    id: '205',
    userId: 'kenya64',
    listingId: '4',
    bookingId: 'bk205',
    rating: 5,
    comment: 'The apartment exceeded my expectations. Very cozy and private.',
    createdAt: '2025-02-03',
    userName: 'Joy Nyambura'
},
{
    id: '206',
    userId: 'kenya65',
    listingId: '4',
    bookingId: 'bk206',
    rating: 5,
    comment: 'Perfect for solo stays. Balcony views were amazing!',
    createdAt: '2025-03-14',
    userName: 'Amos Mwenda'
},
{
    id: '207',
    userId: 'kenya66',
    listingId: '4',
    bookingId: 'bk207',
    rating: 5,
    comment: 'Felt safe and relaxed throughout my stay. Everything worked well.',
    createdAt: '2025-04-08',
    userName: 'Patricia Njeri'
},
{
    id: '208',
    userId: 'kenya67',
    listingId: '4',
    bookingId: 'bk208',
    rating: 5,
    comment: 'Clean, central, and peaceful. Will definitely recommend to friends.',
    createdAt: '2025-05-12',
    userName: 'Allan Kipruto'
},
{
    id: '209',
    userId: 'kenya68',
    listingId: '4',
    bookingId: 'bk209',
    rating: 5,
    comment: 'Professional host and top-class setup. Really enjoyed my stay.',
    createdAt: '2025-05-28',
    userName: 'Catherine Auma'
},
{
    id: '210',
    userId: 'kenya69',
    listingId: '4',
    bookingId: 'bk210',
    rating: 5,
    comment: 'Best Airbnb I’ve stayed in Nairobi. Clean, stylish, and convenient.',
    createdAt: '2025-06-25',
    userName: 'Mark Nderitu'
}
                ];
                setStorageItem(StorageKeys.REVIEWS, sampleReviews);
            }

            if (!getStorageItem(StorageKeys.USERS)) {
                setStorageItem(StorageKeys.USERS, []);
            }
            if (!getStorageItem(StorageKeys.BOOKINGS)) {
                setStorageItem(StorageKeys.BOOKINGS, []);
            }
        };

        // Load data
        const loadData = () => {
            const savedUser = getStorageItem(StorageKeys.CURRENT_USER);
            const savedListings = getStorageItem(StorageKeys.LISTINGS) || [];
            const savedBookings = getStorageItem(StorageKeys.BOOKINGS) || [];
            const savedReviews = getStorageItem(StorageKeys.REVIEWS) || [];

            if (savedUser) AppState.currentUser = savedUser;
            AppState.listings = savedListings.filter(listing => listing.status === 'active');
            AppState.bookings = savedBookings;
            AppState.reviews = savedReviews;
            AppState.filteredListings = AppState.listings;
        };

        // Search functionality - FIXED TO ALLOW CONTINUOUS TYPING
        const handleSearch = (query) => {
            AppState.searchQuery = query;
            if (query.trim()) {
                AppState.filteredListings = AppState.listings.filter(listing =>
                    listing.name.toLowerCase().includes(query.toLowerCase()) ||
                    listing.location.toLowerCase().includes(query.toLowerCase()) ||
                    listing.hostName.toLowerCase().includes(query.toLowerCase())
                );
            } else {
                AppState.filteredListings = AppState.listings;
            }
            
            // Only update the listings section, not the entire page
            updateListingsOnly();
        };

        // New function to update only the listings section
        const updateListingsOnly = () => {
            const listingsContainer = document.getElementById('listings-container');
            if (listingsContainer) {
                listingsContainer.innerHTML = `
                    <!-- Search Results -->
                    ${AppState.searchQuery ? `
                        <div class="mb-6">
                            <p class="text-gray-600">
                                ${AppState.filteredListings.length} result${AppState.filteredListings.length !== 1 ? 's' : ''} for "${AppState.searchQuery}"
                            </p>
                        </div>
                    ` : ''}

                    <!-- Listings Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                        ${AppState.filteredListings.map(listing => ListingCard(listing)).join('')}
                    </div>

                    <!-- Empty State -->
                    ${AppState.filteredListings.length === 0 ? `
                        <div class="text-center py-12">
                            <p class="text-gray-600 text-lg">
                                ${AppState.searchQuery ? 'No listings found matching your search.' : 'No listings available at the moment.'}
                            </p>
                        </div>
                    ` : ''}
                `;
            }
        };

        // Authentication
        const handleLogin = (user) => {
            AppState.currentUser = user;
            setStorageItem(StorageKeys.CURRENT_USER, user);
            AppState.modals.auth = null;
            render();
        };

        const handleLogout = () => {
            AppState.currentUser = null;
            localStorage.removeItem(StorageKeys.CURRENT_USER);
            render();
        };

        // Booking
        const handleBookNow = (listing) => {
            if (!AppState.currentUser) {
                AppState.modals.auth = 'login';
                render();
                return;
            }
            AppState.modals.booking = listing;
            render();
        };

        // Modal management
        const closeModal = (modalName) => {
            AppState.modals[modalName] = modalName === 'auth' ? null : false;
            render();
        };

        const showModal = (modalName, data = true) => {
            AppState.modals[modalName] = data;
            render();
        };

        // Component: Header
        const Header = () => {
            return `
                <header class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-50">
                    <div class="max-w-7xl mx-auto px-3 sm:px-6 lg:px-8">
                        <div class="flex justify-between items-center h-14 sm:h-16">
                            <!-- Logo -->
                            <div class="flex items-center flex-shrink-0">
                                <span class="text-lg sm:text-xl font-bold text-gray-900">Zuri Stays KE</span>
                            </div>

                            <!-- Search - Hidden on mobile, shown on tablet+ -->
                            <div class="hidden md:flex flex-1 max-w-lg mx-4 lg:mx-8">
                                <form onsubmit="handleSearchSubmit(event)" class="relative w-full">
                                    <div class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">
                                        <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                        </svg>
                                    </div>
                                    <input
                                        type="text"
                                        id="searchInput"
                                        oninput="handleSearch(this.value)"
                                        placeholder="Search destinations, hosts..."
                                        class="w-full pl-9 sm:pl-10 pr-4 py-2 text-sm border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-rose-500 focus:border-transparent"
                                    />
                                </form>
                            </div>

                            <!-- User Menu -->
                            <div class="relative flex-shrink-0">
                                ${AppState.currentUser ? `
                                    <div class="relative">
                                        <button
                                            onclick="toggleUserDropdown()"
                                            class="flex items-center space-x-1 sm:space-x-2 bg-white border border-gray-300 rounded-full px-2 sm:px-4 py-1.5 sm:py-2 hover:shadow-md transition-shadow"
                                        >
                                            <span class="text-gray-600">
                                                <svg class="w-3 h-3 sm:w-4 sm:h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                                                </svg>
                                            </span>
                                            <div class="w-6 h-6 sm:w-8 sm:h-8 bg-rose-500 rounded-full flex items-center justify-center overflow-hidden">
                                                ${AppState.currentUser.profilePicture ? `
                                                    <img src="${AppState.currentUser.profilePicture}" alt="Profile" class="w-full h-full object-cover" />
                                                ` : `
                                                    <svg class="w-3 h-3 sm:w-5 sm:h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                                    </svg>
                                                `}
                                            </div>
                                        </button>

                                        <div id="userDropdown" class="hidden absolute right-0 mt-2 w-56 bg-white border border-gray-200 rounded-xl shadow-lg py-2 z-50">
                                            <div class="px-4 py-2 border-b border-gray-100">
                                                <p class="font-medium text-gray-900 text-sm">${AppState.currentUser.name}</p>
                                                <p class="text-xs text-gray-600">${AppState.currentUser.email}</p>
                                            </div>
                                            <button onclick="showModal('profile')" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center space-x-2">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                                </svg>
                                                <span>Profile</span>
                                            </button>
                                            <button onclick="showModal('bookings')" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center space-x-2">
                                                <span>⭐</span>
                                                <span>My Bookings</span>
                                            </button>
                                            <button onclick="showModal('host')" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center space-x-2">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                                </svg>
                                                <span>Become a Host</span>
                                            </button>
                                            <button onclick="showModal('myListings')" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center space-x-2">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                                                </svg>
                                                <span>My Listings</span>
                                            </button>
                                            <button onclick="showModal('support')" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center space-x-2">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                </svg>
                                                <span>Support</span>
                                            </button>
                                            <button onclick="showModal('terms')" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center space-x-2">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                                </svg>
                                                <span>Terms & Conditions</span>
                                            </button>
                                            <hr class="my-2 border-gray-100" />
                                            <button onclick="handleLogout()" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">
                                                Logout
                                            </button>
                                        </div>
                                    </div>
                                ` : `
                                    <div class="flex items-center space-x-2 sm:space-x-4">
                                        <button onclick="showModal('auth', 'login')" class="text-gray-700 hover:text-gray-900 font-medium text-sm">
                                            Sign In
                                        </button>
                                        <button onclick="showModal('auth', 'register')" class="bg-rose-500 text-white px-3 sm:px-4 py-1.5 sm:py-2 rounded-full hover:bg-rose-600 transition-colors text-sm font-medium">
                                            Sign Up
                                        </button>
                                    </div>
                                `}
                            </div>
                        </div>
                    </div>

                    <!-- Mobile Search Bar -->
                    <div class="md:hidden border-t border-gray-200 px-3 py-3">
                        <input
                            type="text"
                            id="mobileSearchInput"
                            oninput="handleSearch(this.value)"
                            placeholder="Search destinations, hosts, or properties..."
                            class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-rose-500 focus:border-transparent"
                        />
                    </div>
                </header>
            `;
        };

        // Component: Listing Card
        const ListingCard = (listing) => {
            return `
                <div class="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-xl transition-shadow duration-300">
                    <!-- Image Carousel -->
                    <div class="relative h-64 bg-gray-200 carousel-container">
                        ${listing.images.length > 0 ? `
                            <div class="carousel-track" id="carousel-${listing.id}" style="transform: translateX(0%)">
                                ${listing.images.map(image => `
                                    <div class="carousel-slide">
                                        <img src="${image}" alt="${listing.name}" class="w-full h-64 object-cover" />
                                    </div>
                                `).join('')}
                            </div>
                            ${listing.images.length > 1 ? `
                                <button onclick="prevImage('${listing.id}')" class="absolute left-2 top-1/2 -translate-y-1/2 bg-white bg-opacity-80 hover:bg-opacity-100 rounded-full p-2 shadow-lg transition-all">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                    </svg>
                                </button>
                                <button onclick="nextImage('${listing.id}')" class="absolute right-2 top-1/2 -translate-y-1/2 bg-white bg-opacity-80 hover:bg-opacity-100 rounded-full p-2 shadow-lg transition-all">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                    </svg>
                                </button>
                                <div class="absolute bottom-2 left-1/2 -translate-x-1/2 flex space-x-1">
                                    ${listing.images.map((_, index) => `
                                        <button onclick="setImageIndex('${listing.id}', ${index})" class="w-2 h-2 rounded-full transition-all ${index === 0 ? 'bg-white' : 'bg-white bg-opacity-50'}"></button>
                                    `).join('')}
                                </div>
                            ` : ''}
                        ` : ''}
                    </div>

                    <div class="p-6">
                        <!-- Header -->
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex-1">
                                <h3 class="text-lg font-semibold text-gray-900 mb-1">${listing.name}</h3>
                                <div class="flex items-center text-gray-600 text-sm">
                                    <span>${listing.location}</span>
                                </div>
                            </div>
                            ${listing.averageRating ? `
                                <div class="flex items-center bg-gray-50 rounded-full px-2 py-1">
                                    <span class="text-yellow-500 mr-1">⭐</span>
                                    <span class="text-sm font-medium">${listing.averageRating}</span>
                                </div>
                            ` : ''}
                        </div>

                        <!-- Host Info -->
                        <div class="flex items-center mb-4">
                            <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center mr-3 overflow-hidden">
                                ${listing.hostProfilePicture ? `
                                    <img src="${listing.hostProfilePicture}" alt="${listing.hostName}" class="w-full h-full object-cover" />
                                ` : `
                                    <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                    </svg>
                                `}
                            </div>
                            <div>
                                <p class="text-sm font-medium text-gray-900">${listing.hostName}</p>
                                <p class="text-xs text-gray-600">Host</p>
                            </div>
                        </div>

                        <!-- Features -->
                        <div class="flex flex-wrap gap-2 mb-4">
                            ${listing.features.map(feature => `
                                <div class="bg-blue-50 text-blue-700 px-2 py-1 rounded-full text-xs">
                                    <span class="capitalize">${feature}</span>
                                </div>
                            `).join('')}
                        </div>

                        <!-- Price and Book Button -->
                        <div class="flex items-center justify-between mb-3">
                            <div>
                                <span class="text-xl font-bold text-gray-900">$${listing.price}</span>
                                <span class="text-gray-600 text-sm"> / night</span>
                            </div>
                            <button onclick="handleBookNow(${JSON.stringify(listing).replace(/"/g, '&quot;')})" class="bg-rose-500 text-white px-6 py-2 rounded-full hover:bg-rose-600 transition-colors font-medium">
                                Book Now
                            </button>
                        </div>

                        <!-- Reviews section -->
                        ${listing.totalReviews ? `
                            <div class="pt-3 border-t border-gray-100">
                                <div class="flex items-center justify-between">
                                    <p class="text-sm text-gray-600">
                                        ${listing.totalReviews} review${listing.totalReviews !== 1 ? 's' : ''}
                                    </p>
                                    <button onclick="showModal('reviews', ${JSON.stringify(listing).replace(/"/g, '&quot;')})" class="text-rose-500 hover:text-rose-600 text-sm font-medium">
                                        Read Reviews
                                    </button>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        };

        // Component: Auth Modal
        const AuthModal = () => {
            if (!AppState.modals.auth) return '';
            
            const type = AppState.modals.auth;
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center modal-base p-4">
                    <div class="bg-white rounded-xl shadow-xl w-full max-w-sm max-h-[80vh] scrollable-content overflow-y-auto">
                        <div class="p-6">
                            <div class="flex items-center justify-between mb-6">
                                <h2 class="text-2xl font-bold text-gray-900">
                                    ${type === 'login' ? 'Sign In' : 'Sign Up'}
                                </h2>
                                <button onclick="closeModal('auth')" class="text-gray-400 hover:text-gray-600 transition-colors">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>

                            <form onsubmit="handleAuthSubmit(event, '${type}')" class="space-y-4">
                                ${type === 'register' ? `
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                                        <input type="text" name="name" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-rose-500" placeholder="Enter your full name" />
                                    </div>
                                ` : ''}

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                    <input type="email" name="email" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-rose-500" placeholder="Enter your email" />
                                </div>

                                ${type === 'register' ? `
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Country</label>
                                        <select name="country" onchange="updatePhoneCode(this)" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-rose-500">
                                            <option value="">Select your country</option>
                                            ${countries.map(country => `
                                                <option value="${country.name}" data-code="${country.code}">${country.name}</option>
                                            `).join('')}
                                        </select>
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
                                        <input type="tel" name="phone" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-rose-500" placeholder="Phone number with country code" />
                                    </div>
                                ` : ''}

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                                    <input type="password" name="password" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-rose-500" placeholder="Enter your password" />
                                </div>

                                ${type === 'register' ? `
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Confirm Password</label>
                                        <input type="password" name="confirmPassword" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-rose-500" placeholder="Confirm your password" />
                                    </div>
                                ` : ''}

                                <button type="submit" class="w-full bg-rose-500 text-white py-2 px-4 rounded-lg hover:bg-rose-600 transition-colors">
                                    ${type === 'login' ? 'Sign In' : 'Sign Up'}
                                </button>
                            </form>

                            <div class="mt-6 text-center">
                                <button onclick="closeModal('auth')" class="text-gray-600 hover:text-gray-800 transition-colors">
                                    Cancel
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        };

        // Component: Profile Modal
        const ProfileModal = () => {
            if (!AppState.modals.profile) return '';
            
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center modal-base p-4">
                    <div class="bg-white rounded-xl shadow-xl w-full max-w-sm max-h-[90vh] scrollable-content overflow-y-auto">
                        <div class="p-6">
                            <div class="flex items-center justify-between mb-6">
                                <h2 class="text-2xl font-bold text-gray-900">Profile</h2>
                                <button onclick="closeModal('profile')" class="text-gray-400 hover:text-gray-600 transition-colors">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>

                            <div class="space-y-6">
                                <!-- Profile Picture -->
                                <div class="text-center">
                                    <div class="relative inline-block">
                                        <div class="w-24 h-24 bg-gray-300 rounded-full flex items-center justify-center mx-auto mb-4 overflow-hidden cursor-pointer" onclick="document.getElementById('profilePictureInput').click()">
                                            ${AppState.currentUser.profilePicture ? `
                                                <img src="${AppState.currentUser.profilePicture}" alt="Profile" class="w-full h-full object-cover" />
                                            ` : `
                                                <svg class="w-12 h-12 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                                </svg>
                                            `}
                                        </div>
                                        <input type="file" id="profilePictureInput" accept="image/*" onchange="handleProfilePictureUpload(event)" class="hidden" />
                                        <button onclick="document.getElementById('profilePictureInput').click()" class="absolute bottom-0 right-0 bg-rose-500 text-white rounded-full p-2 hover:bg-rose-600 transition-colors">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path>
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                            </svg>
                                        </button>
                                    </div>
                                    <p class="text-sm text-gray-600">Click to upload profile picture</p>
                                </div>

                                <!-- User Info -->
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                                        <p class="text-gray-900">${AppState.currentUser.name}</p>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                        <p class="text-gray-900">${AppState.currentUser.email}</p>
                                    </div>
                                    ${AppState.currentUser.country ? `
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Country</label>
                                            <p class="text-gray-900">${AppState.currentUser.country}</p>
                                        </div>
                                    ` : ''}
                                    ${AppState.currentUser.phone ? `
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
                                            <p class="text-gray-900">${AppState.currentUser.phone}</p>
                                        </div>
                                    ` : ''}
                                </div>

                                <button onclick="closeModal('profile')" class="w-full bg-rose-500 text-white py-2 px-4 rounded-lg hover:bg-rose-600 transition-colors">
                                    Close
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        };

        // Component: Bookings Modal
        const BookingsModal = () => {
            if (!AppState.modals.bookings) return '';
            
            const userBookings = AppState.bookings.filter(booking => booking.userId === AppState.currentUser?.id);
            
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center modal-base p-4">
                    <div class="bg-white rounded-xl shadow-xl w-full max-w-sm max-h-[90vh] scrollable-content overflow-y-auto">
                        <div class="p-6">
                            <div class="flex items-center justify-between mb-6">
                                <h2 class="text-2xl font-bold text-gray-900">My Bookings</h2>
                                <button onclick="closeModal('bookings')" class="text-gray-400 hover:text-gray-600 transition-colors">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>

                            <div class="space-y-4">
                                ${userBookings.length > 0 ? userBookings.map(booking => `
                                    <div class="border border-gray-200 rounded-lg p-4">
                                        <h3 class="font-semibold text-gray-900 mb-2">${booking.listingName}</h3>
                                        <div class="space-y-1 text-sm text-gray-600">
                                            <p>Location: ${booking.location}</p>
                                            <p>Check-in: ${booking.checkIn}</p>
                                            <p>Check-out: ${booking.checkOut}</p>
                                            <p>Nights: ${booking.nights}</p>
                                            <p>Total: ${formatCurrency(booking.totalUSD, 'USD')} (${formatCurrency(booking.totalKES, 'KES')})</p>
                                            <p>Status: <span class="font-medium text-green-600">${booking.status}</span></p>
                                        </div>
                                    </div>
                                `).join('') : '<p class="text-gray-600 text-center py-8">No bookings yet.</p>'}
                            </div>

                            <button onclick="closeModal('bookings')" class="w-full mt-6 bg-rose-500 text-white py-2 px-4 rounded-lg hover:bg-rose-600 transition-colors">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            `;
        };

        // Component: Host Modal - UPDATED WITH CHECKBOXES AND VISITOR SELECTION
        const HostModal = () => {
            if (!AppState.modals.host) return '';
            
            const features = [
                'bed', 'kitchen', 'wifi', 'tv', 'shower', 'parking', 'pool', 'gym', 'balcony', 'garden',
                'air conditioning', 'heating', 'washing machine', 'dryer', 'dishwasher', 'microwave',
                'refrigerator', 'coffee maker', 'toaster', 'iron', 'hair dryer', 'towels', 'bed linens',
                'soap', 'toilet paper', 'shampoo', 'hot water', 'lockbox', 'hangers', 'laptop workspace',
                'tv with standard cable', 'sound system', 'books and reading material', 'board games',
                'exercise equipment', 'pool table', 'piano', 'fireplace', 'patio', 'bbq grill',
                'outdoor furniture', 'beach access', 'ski access', 'lake access', 'waterfront',
                'mountain view', 'city view', 'garden view'
            ];

            const hostRules = [
                'No smoking',
                'No pets allowed',
                'No parties or events',
                'Check-in after 3:00 PM',
                'Check-out before 11:00 AM',
                'Quiet hours from 10 PM to 8 AM',
                'No outside guests without permission',
                'Clean up after yourself',
                'Report any damages immediately',
                'Respect neighbors and property'
            ];

            const propertyTypes = [
                'Studio',
                '1 Bedroom Apartment',
                '2 Bedroom Apartment',
                '3 Bedroom Apartment',
                '1 Bedroom House',
                '2 Bedroom House',
                '3 Bedroom House',
                '4+ Bedroom House',
                'Villa',
                'Cottage',
                'Loft',
                'Penthouse'
            ];
            
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center modal-base p-4">
                    <div class="bg-white rounded-xl shadow-xl w-full max-w-sm max-h-[90vh] scrollable-content overflow-y-auto">
                        <div class="p-6">
                            <div class="flex items-center justify-between mb-6">
                                <h2 class="text-2xl font-bold text-gray-900">Become a Host</h2>
                                <button onclick="closeModal('host')" class="text-gray-400 hover:text-gray-600 transition-colors">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>

                            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-6">
                                <p class="text-sm text-yellow-800 font-medium">
                                    Note: Your listing must be verified by our field agents before being published live.
                                </p>
                            </div>

                            <form onsubmit="handleHostSubmit(event)" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Property Name</label>
                                    <input type="text" name="name" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-rose-500" placeholder="Enter property name" />
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Property Type</label>
                                    <select name="propertyType" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-rose-500">
                                        <option value="">Select Property Type</option>
                                        ${propertyTypes.map(type => `
                                            <option value="${type}">${type}</option>
                                        `).join('')}
                                    </select>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">County</label>
                                    <select name="county" onchange="updateSubcounties(this)" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-rose-500">
                                        <option value="">Select County</option>
                                        ${Object.keys(kenyaCounties).map(county => `
                                            <option value="${county}">${county}</option>
                                        `).join('')}
                                    </select>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Subcounty</label>
                                    <select name="subcounty" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-rose-500">
                                        <option value="">Select Subcounty</option>
                                    </select>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Price per Night (USD)</label>
                                    <input type="number" name="price" required min="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-rose-500" placeholder="Enter price" />
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Number of Guests (2 to 10)</label>
                                    <select name="maxGuests" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-rose-500">
                                        <option value="">Select Maximum Guests</option>
                                        ${Array.from({length: 9}, (_, i) => i + 2).map(num => `
                                            <option value="${num}">${num} Guest${num > 1 ? 's' : ''}</option>
                                        `).join('')}
                                    </select>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Direction Description</label>
                                    <textarea name="directions" required rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-rose-500" placeholder="Provide clear directions to your property"></textarea>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                    <textarea name="description" required rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-rose-500" placeholder="Describe your property"></textarea>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Property Images</label>
                                    <input type="file" name="images" multiple accept="image/*" onchange="handleImageUpload(event)" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-rose-500" />
                                    <p class="text-xs text-gray-500 mt-1">Select multiple images</p>
                                    <div id="imagePreview" class="mt-2 grid grid-cols-2 gap-2"></div>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Features & Amenities</label>
                                    <div class="max-h-32 scrollable-content overflow-y-auto border border-gray-300 rounded-lg p-3">
                                        <div class="grid grid-cols-1 gap-2">
                                            ${features.map(feature => `
                                                <label class="flex items-center space-x-2">
                                                    <input type="checkbox" name="features" value="${feature}" class="rounded border-gray-300 text-rose-500 focus:ring-rose-500" />
                                                    <span class="text-sm capitalize">${feature}</span>
                                                </label>
                                            `).join('')}
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Host Rules</label>
                                    <div class="max-h-32 scrollable-content overflow-y-auto border border-gray-300 rounded-lg p-3">
                                        <div class="grid grid-cols-1 gap-2">
                                            ${hostRules.map(rule => `
                                                <label class="flex items-center space-x-2">
                                                    <input type="checkbox" name="hostRules" value="${rule}" class="rounded border-gray-300 text-rose-500 focus:ring-rose-500" />
                                                    <span class="text-sm">${rule}</span>
                                                </label>
                                            `).join('')}
                                        </div>
                                    </div>
                                </div>

                                <button type="submit" class="w-full bg-rose-500 text-white py-2 px-4 rounded-lg hover:bg-rose-600 transition-colors">
                                    Submit for Review
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            `;
        };

        // Component: My Listings Modal
        const MyListingsModal = () => {
            if (!AppState.modals.myListings) return '';
            
            const allListings = getStorageItem(StorageKeys.LISTINGS) || [];
            const userListings = allListings.filter(listing => listing.hostId === AppState.currentUser?.id);
            
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center modal-base p-4">
                    <div class="bg-white rounded-xl shadow-xl w-full max-w-sm max-h-[90vh] scrollable-content overflow-y-auto">
                        <div class="p-6">
                            <div class="flex items-center justify-between mb-6">
                                <h2 class="text-2xl font-bold text-gray-900">My Listings</h2>
                                <button onclick="closeModal('myListings')" class="text-gray-400 hover:text-gray-600 transition-colors">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>

                            <div class="space-y-4">
                                ${userListings.length > 0 ? userListings.map(listing => `
                                    <div class="border border-gray-200 rounded-lg p-4">
                                        <h3 class="font-semibold text-gray-900 mb-2">${listing.name}</h3>
                                        <div class="space-y-1 text-sm text-gray-600">
                                            <p>Location: ${listing.location}</p>
                                            <p>Price: $${listing.price}/night</p>
                                            <p>Status: <span class="font-medium ${listing.status === 'active' ? 'text-green-600' : 'text-yellow-600'}">${listing.status === 'active' ? 'Active' : 'Under review by admin'}</span></p>
                                        </div>
                                    </div>
                                `).join('') : '<p class="text-gray-600 text-center py-8">No listings yet.</p>'}
                            </div>

                            <button onclick="closeModal('myListings')" class="w-full mt-6 bg-rose-500 text-white py-2 px-4 rounded-lg hover:bg-rose-600 transition-colors">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            `;
        };

        // Component: Booking Modal - UPDATED WITH VISITOR SELECTION 2-10
        const BookingModal = () => {
            if (!AppState.modals.booking) return '';
            
            const listing = AppState.modals.booking;
            const today = new Date().toISOString().split('T')[0];
            
            const hostRules = [
                "No smoking",
                "No pets allowed",
                "No parties or events",
                "Check-in after 3:00 PM",
                "Check-out before 11:00 AM"
            ];
            
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center modal-base p-4">
                    <div class="bg-white rounded-xl shadow-xl w-full max-w-sm max-h-[90vh] scrollable-content overflow-y-auto">
                        <div class="p-6">
                            <div class="flex items-center justify-between mb-6">
                                <h2 class="text-2xl font-bold text-gray-900">Book Your Stay</h2>
                                <button onclick="closeModal('booking')" class="text-gray-400 hover:text-gray-600 transition-colors">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            
                            <div class="space-y-6">
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <h3 class="font-semibold text-gray-900">${listing.name}</h3>
                                    <p class="text-gray-600">${listing.location}</p>
                                    <p class="text-rose-600 font-bold">$${listing.price} / night</p>
                                </div>

                                <form onsubmit="handleBookingSubmit(event, ${JSON.stringify(listing).replace(/"/g, '&quot;')})" class="space-y-4">
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Check-in Date</label>
                                            <input type="date" name="checkIn" onchange="calculateNights()" required min="${today}" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-rose-500" />
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Check-out Date</label>
                                            <input type="date" name="checkOut" onchange="calculateNights()" required min="${today}" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-rose-500" />
                                        </div>
                                    </div>

                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Check-in Time</label>
                                            <select name="checkInTime" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-rose-500">
                                                <option value="15:00">3:00 PM</option>
                                                <option value="16:00">4:00 PM</option>
                                                <option value="17:00">5:00 PM</option>
                                                <option value="18:00">6:00 PM</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Check-out Time</label>
                                            <select name="checkOutTime" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-rose-500">
                                                <option value="10:00">10:00 AM</option>
                                                <option value="11:00">11:00 AM</option>
                                                <option value="12:00">12:00 PM</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Number of Nights</label>
                                        <div class="flex items-center space-x-4">
                                            <button type="button" onclick="changeNights(-1)" class="bg-gray-200 hover:bg-gray-300 rounded-full w-10 h-10 flex items-center justify-center">-</button>
                                            <span id="nightsDisplay" class="text-xl font-semibold">1</span>
                                            <button type="button" onclick="changeNights(1)" class="bg-gray-200 hover:bg-gray-300 rounded-full w-10 h-10 flex items-center justify-center">+</button>
                                        </div>
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Number of Guests (2 to 10)</label>
                                        <select name="guests" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-rose-500">
                                            ${Array.from({length: 9}, (_, i) => i + 2).map(num => `
                                                <option value="${num}">${num} Guest${num > 1 ? 's' : ''}</option>
                                            `).join('')}
                                        </select>
                                    </div>

                                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                                        <h4 class="font-medium text-yellow-900 mb-2">Host Rules</h4>
                                        <ul class="text-sm text-yellow-800 space-y-1">
                                            ${hostRules.map(rule => `<li>• ${rule}</li>`).join('')}
                                        </ul>
                                    </div>

                                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                                        <h4 class="font-medium text-blue-900 mb-2">Directions</h4>
                                        <p class="text-sm text-blue-800">
                                            Located in ${listing.location}. Detailed directions will be provided after booking confirmation.
                                        </p>
                                    </div>

                                    <div class="bg-blue-50 p-4 rounded-lg">
                                        <div class="flex justify-between items-center">
                                            <span class="text-gray-700">Total Cost:</span>
                                            <span id="totalCost" class="text-2xl font-bold text-blue-600">$${listing.price}</span>
                                        </div>
                                    </div>

                                    <div class="flex space-x-4">
                                        <button type="button" onclick="closeModal('booking')" class="flex-1 bg-gray-200 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-300 transition-colors">
                                            Cancel
                                        </button>
                                        <button type="submit" class="flex-1 bg-rose-500 text-white py-2 px-4 rounded-lg hover:bg-rose-600 transition-colors">
                                            Booking
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        };

        // Component: Reviews Modal
        const ReviewsModal = () => {
            if (!AppState.modals.reviews) return '';
            
            const listing = AppState.modals.reviews;
            const listingReviews = AppState.reviews.filter(review => review.listingId === listing.id);
            
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center modal-base p-4">
                    <div class="bg-white rounded-xl shadow-xl w-full max-w-sm max-h-[90vh] scrollable-content overflow-y-auto">
                        <div class="p-6">
                            <div class="flex items-center justify-between mb-6">
                                <div>
                                    <h2 class="text-2xl font-bold text-gray-900">Reviews</h2>
                                    <p class="text-gray-600">${listing.name} - ${listing.location}</p>
                                </div>
                                <button onclick="closeModal('reviews')" class="text-gray-400 hover:text-gray-600 transition-colors">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>

                            <!-- Existing Reviews -->
                            <div class="space-y-4 mb-6">
                                ${listingReviews.length > 0 ? listingReviews.map(review => `
                                    <div class="border border-gray-200 rounded-lg p-4">
                                        <div class="flex items-center justify-between mb-2">
                                            <div class="flex items-center space-x-2">
                                                <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center">
                                                    <span class="text-sm font-medium text-gray-600">${review.userName.charAt(0).toUpperCase()}</span>
                                                </div>
                                                <span class="font-medium text-gray-900">${review.userName}</span>
                                            </div>
                                        </div>
                                        <p class="text-gray-700">${review.comment}</p>
                                        <p class="text-xs text-gray-500 mt-2">${new Date(review.createdAt).toLocaleDateString()}</p>
                                    </div>
                                `).join('') : '<p class="text-gray-600 text-center py-8">No reviews yet.</p>'}
                            </div>

                            <!-- Write Review Section -->
                            <div class="border-t border-gray-200 pt-6">
                                <h3 class="text-lg font-semibold text-gray-900 mb-4">Write a Review</h3>
                                
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Your Review</label>
                                    <textarea id="reviewText" placeholder="Share your experience..." rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-rose-500"></textarea>
                                </div>

                                <button onclick="handleReviewSubmit('${listing.hostName}')" class="w-full bg-rose-500 text-white px-4 py-2 rounded-lg hover:bg-rose-600 transition-colors">
                                    Submit Review
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        };

        // Component: Support Modal
        const SupportModal = () => {
            if (!AppState.modals.support) return '';
            
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center modal-base p-4">
                    <div class="bg-white rounded-xl shadow-xl w-full max-w-sm max-h-[80vh] scrollable-content overflow-y-auto">
                        <div class="p-6">
                            <div class="flex items-center justify-between mb-6">
                                <h2 class="text-2xl font-bold text-gray-900">Support</h2>
                                <button onclick="closeModal('support')" class="text-gray-400 hover:text-gray-600 transition-colors">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>

                            <div class="space-y-4">
                                <div class="text-center mb-6">
                                    <div class="text-4xl text-rose-500 mb-3">
                                        <svg class="w-16 h-16 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                                        </svg>
                                    </div>
                                    <h3 class="text-lg font-semibold text-gray-900 mb-2">Need Help?</h3>
                                    <p class="text-gray-600">Get in touch with our support team</p>
                                </div>

                                <div class="space-y-4">
                                    <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                                        <svg class="w-6 h-6 text-rose-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                        </svg>
                                        <div>
                                            <p class="text-sm font-medium text-gray-900">Email</p>
                                            <a href="mailto:support@zuristayske.com" class="text-sm text-rose-600 hover:text-rose-700">
                                                support@zuristayske.com
                                            </a>
                                        </div>
                                    </div>

                                    <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                                        <svg class="w-6 h-6 text-rose-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                                        </svg>
                                        <div>
                                            <p class="text-sm font-medium text-gray-900">Phone</p>
                                            <a href="tel:+254700123456" class="text-sm text-rose-600 hover:text-rose-700">
                                                +254 700 123 456
                                            </a>
                                        </div>
                                    </div>
                                </div>

                                <div class="mt-6 p-4 bg-blue-50 rounded-lg">
                                    <h4 class="text-sm font-medium text-blue-900 mb-2">Support Hours</h4>
                                    <p class="text-sm text-blue-800">Monday - Friday: 8:00 AM - 6:00 PM EAT</p>
                                    <p class="text-sm text-blue-800">Saturday - Sunday: 9:00 AM - 5:00 PM EAT</p>
                                </div>

                                <button onclick="closeModal('support')" class="w-full bg-rose-500 text-white py-2 px-4 rounded-lg hover:bg-rose-600 transition-colors">
                                    Close
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        };

        // Component: Terms & Conditions Modal
        const TermsModal = () => {
            if (!AppState.modals.terms) return '';
            
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center modal-base p-4">
                    <div class="bg-white rounded-xl shadow-xl w-full max-w-sm max-h-[80vh] scrollable-content overflow-y-auto">
                        <div class="p-6">
                            <div class="flex items-center justify-between mb-6">
                                <h2 class="text-2xl font-bold text-gray-900">Terms & Conditions</h2>
                                <button onclick="closeModal('terms')" class="text-gray-400 hover:text-gray-600 transition-colors">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>

                            <div class="space-y-6 text-sm text-gray-700">
                                <div>
                                    <h3 class="font-semibold text-gray-900 mb-2">1. Booking & Payment Terms</h3>
                                    <p class="mb-2">All payments must be completed in full before check-in. No partial payments or pay-on-arrival options are available.</p>
                                    <p>Accepted payment methods include M-PESA and other mobile money services. Transaction IDs must be provided for verification.</p>
                                </div>

                                <div>
                                    <h3 class="font-semibold text-gray-900 mb-2">2. Cancellation Policy</h3>
                                    <p class="mb-2">Cancellations made 48 hours before check-in: Full refund minus 10% processing fee.</p>
                                    <p class="mb-2">Cancellations made 24-48 hours before: 50% refund.</p>
                                    <p>Cancellations made less than 24 hours before: No refund.</p>
                                </div>

                                <div>
                                    <h3 class="font-semibold text-gray-900 mb-2">3. Guest Responsibilities</h3>
                                    <p class="mb-2">Guests must respect property rules and local regulations. Any damages will be charged separately.</p>
                                    <p>Maximum occupancy limits must be strictly observed. Smoking is prohibited unless explicitly allowed.</p>
                                </div>

                                <div>
                                    <h3 class="font-semibold text-gray-900 mb-2">4. Host Obligations</h3>
                                    <p class="mb-2">Hosts must provide accurate property descriptions and ensure cleanliness standards.</p>
                                    <p>Properties must be available as booked with all advertised amenities functional.</p>
                                </div>

                                <div>
                                    <h3 class="font-semibold text-gray-900 mb-2">5. Platform Policies</h3>
                                    <p class="mb-2">Zuri Stays KE reserves the right to cancel bookings for safety or security reasons.</p>
                                    <p>All users must provide accurate information and comply with verification requirements.</p>
                                </div>

                                <div>
                                    <h3 class="font-semibold text-gray-900 mb-2">6. Dispute Resolution</h3>
                                    <p class="mb-2">Disputes will be handled through our customer support team within 48 hours.</p>
                                    <p>Escalated matters will be resolved according to Kenyan law and jurisdiction.</p>
                                </div>

                                <div>
                                    <h3 class="font-semibold text-gray-900 mb-2">7. Privacy & Data Protection</h3>
                                    <p class="mb-2">Personal information is protected according to Kenya's Data Protection Act.</p>
                                    <p>Data is used solely for booking purposes and platform improvement.</p>
                                </div>

                                <div class="bg-rose-50 p-4 rounded-lg">
                                    <p class="text-rose-800 font-medium">By using Zuri Stays KE, you agree to these terms and conditions. Last updated: January 2024.</p>
                                </div>
                            </div>

                            <button onclick="closeModal('terms')" class="w-full mt-6 bg-rose-500 text-white py-2 px-4 rounded-lg hover:bg-rose-600 transition-colors">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            `;
        };

        // Main render function
        const render = () => {
            const app = document.getElementById('app');
            app.innerHTML = `
                ${Header()}
                
                <!-- Main Content -->
                <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                    <div id="listings-container">
                        <!-- Search Results -->
                        ${AppState.searchQuery ? `
                            <div class="mb-6">
                                <p class="text-gray-600">
                                    ${AppState.filteredListings.length} result${AppState.filteredListings.length !== 1 ? 's' : ''} for "${AppState.searchQuery}"
                                </p>
                            </div>
                        ` : ''}

                        <!-- Listings Grid -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                            ${AppState.filteredListings.map(listing => ListingCard(listing)).join('')}
                        </div>

                        <!-- Empty State -->
                        ${AppState.filteredListings.length === 0 ? `
                            <div class="text-center py-12">
                                <p class="text-gray-600 text-lg">
                                    ${AppState.searchQuery ? 'No listings found matching your search.' : 'No listings available at the moment.'}
                                </p>
                            </div>
                        ` : ''}
                    </div>
                </main>

                <!-- Modals -->
                ${AuthModal()}
                ${ProfileModal()}
                ${BookingModal()}
                ${BookingsModal()}
                ${HostModal()}
                ${MyListingsModal()}
                ${ReviewsModal()}
                ${SupportModal()}
                ${TermsModal()}
            `;
        };

        // Event handlers
        window.handleSearchSubmit = (event) => {
            event.preventDefault();
        };

        window.toggleUserDropdown = () => {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('hidden');
        };

        window.updatePhoneCode = (select) => {
            const selectedOption = select.options[select.selectedIndex];
            const code = selectedOption.getAttribute('data-code');
            const phoneInput = select.form.phone;
            if (phoneInput && code) {
                phoneInput.value = code + ' ';
            }
        };

        window.updateSubcounties = (select) => {
            const county = select.value;
            const subcountySelect = select.form.subcounty;
            subcountySelect.innerHTML = '<option value="">Select Subcounty</option>';
            
            if (county && kenyaCounties[county]) {
                kenyaCounties[county].forEach(subcounty => {
                    const option = document.createElement('option');
                    option.value = subcounty;
                    option.textContent = subcounty;
                    subcountySelect.appendChild(option);
                });
            }
        };

        window.handleProfilePictureUpload = (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    AppState.currentUser.profilePicture = e.target.result;
                    
                    // Update user in storage
                    const users = getStorageItem(StorageKeys.USERS) || [];
                    const userIndex = users.findIndex(u => u.id === AppState.currentUser.id);
                    if (userIndex !== -1) {
                        users[userIndex] = AppState.currentUser;
                        setStorageItem(StorageKeys.USERS, users);
                    }
                    setStorageItem(StorageKeys.CURRENT_USER, AppState.currentUser);
                    
                    render();
                };
                reader.readAsDataURL(file);
            }
        };

        window.handleImageUpload = (event) => {
            const files = Array.from(event.target.files);
            const preview = document.getElementById('imagePreview');
            preview.innerHTML = '';
            
            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.className = 'w-full h-20 object-cover rounded';
                    preview.appendChild(img);
                };
                reader.readAsDataURL(file);
            });
        };

        window.handleHostSubmit = async (event) => {
            event.preventDefault();
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData);
            
            // Get selected features
            const features = Array.from(event.target.querySelectorAll('input[name="features"]:checked')).map(cb => cb.value);
            
            // Get selected host rules
            const hostRules = Array.from(event.target.querySelectorAll('input[name="hostRules"]:checked')).map(cb => cb.value);
            
            // Get uploaded images
            const imageFiles = Array.from(event.target.images.files);
            const images = [];
            
            for (const file of imageFiles) {
                const reader = new FileReader();
                const imageData = await new Promise(resolve => {
                    reader.onload = e => resolve(e.target.result);
                    reader.readAsDataURL(file);
                });
                images.push(imageData);
            }
            
            const newListing = {
                id: Date.now().toString(),
                name: data.name,
                propertyType: data.propertyType,
                location: `${data.subcounty}, ${data.county}`,
                price: parseInt(data.price),
                description: data.description,
                directions: data.directions,
                maxGuests: parseInt(data.maxGuests),
                images: images,
                features: features,
                hostRules: hostRules,
                hostId: AppState.currentUser.id,
                hostName: AppState.currentUser.name,
                hostProfilePicture: AppState.currentUser.profilePicture,
                status: 'pending',
                averageRating: 0,
                totalReviews: 0,
                createdAt: new Date().toISOString()
            };
            
            const listings = getStorageItem(StorageKeys.LISTINGS) || [];
            listings.push(newListing);
            setStorageItem(StorageKeys.LISTINGS, listings);
            
            closeModal('host');
            showSuccessModal('Your property is now under review and will be published once approved by our team.');
        };

        window.handleAuthSubmit = async (event, type) => {
            event.preventDefault();
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData);

            if (type === 'login') {
                const users = getStorageItem(StorageKeys.USERS) || [];
                const user = users.find(u => u.email === data.email && u.password === data.password);
                if (user) {
                    handleLogin(user);
                } else {
                    showErrorModal('Invalid email or password');
                }
            } else {
                if (data.password !== data.confirmPassword) {
                    showErrorModal('Passwords do not match');
                    return;
                }
                
                const users = getStorageItem(StorageKeys.USERS) || [];
                if (users.find(u => u.email === data.email)) {
                    showErrorModal('Email already exists');
                    return;
                }

                const newUser = {
                    id: Date.now().toString(),
                    name: data.name,
                    email: data.email,
                    country: data.country,
                    phone: data.phone,
                    password: data.password
                };

                users.push(newUser);
                setStorageItem(StorageKeys.USERS, users);
                
                // Send user registration email
                await sendUserRegistration(newUser);
                
                handleLogin(newUser);
                showSuccessModal('Account created successfully! Welcome to Zuri Stays KE.');
            }
        };

        window.calculateNights = () => {
            const checkIn = document.querySelector('input[name="checkIn"]').value;
            const checkOut = document.querySelector('input[name="checkOut"]').value;
            
            if (checkIn && checkOut) {
                const checkInDate = new Date(checkIn);
                const checkOutDate = new Date(checkOut);
                const timeDiff = checkOutDate.getTime() - checkInDate.getTime();
                const daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24));
                
                if (daysDiff > 0) {
                    document.getElementById('nightsDisplay').textContent = daysDiff;
                    updateTotalCost(daysDiff);
                }
            }
        };

        window.changeNights = (change) => {
            const currentNights = parseInt(document.getElementById('nightsDisplay').textContent);
            const newNights = Math.max(1, currentNights + change);
            document.getElementById('nightsDisplay').textContent = newNights;
            
            // Update checkout date
            const checkInInput = document.querySelector('input[name="checkIn"]');
            if (checkInInput.value) {
                const checkInDate = new Date(checkInInput.value);
                const newCheckOutDate = new Date(checkInDate);
                newCheckOutDate.setDate(checkInDate.getDate() + newNights);
                document.querySelector('input[name="checkOut"]').value = newCheckOutDate.toISOString().split('T')[0];
            }
            
            updateTotalCost(newNights);
        };

        window.updateTotalCost = (nights) => {
            const listing = AppState.modals.booking;
            const total = listing.price * nights;
            document.getElementById('totalCost').textContent = `$${total}`;
        };

        window.handleBookingSubmit = async (event, listing) => {
            event.preventDefault();
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData);
            const nights = parseInt(document.getElementById('nightsDisplay').textContent);
            const totalUSD = listing.price * nights;
            const totalKES = await convertUSDToKES(totalUSD);

            // Show payment modal
            showPaymentModal(listing, data, nights, totalUSD, totalKES);
        };

        window.showPaymentModal = (listing, bookingData, nights, totalUSD, totalKES) => {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center modal-secondary p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-xl shadow-xl w-full max-w-sm max-h-[80vh] scrollable-content overflow-y-auto">
                    <div class="p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-2xl font-bold text-gray-900">Payment</h2>
                            <button onclick="this.closest('.fixed').remove(); closeModal('booking')" class="text-gray-400 hover:text-gray-600 transition-colors">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                        
                        <div class="space-y-6">
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h3 class="font-semibold text-gray-900 mb-2">Booking Summary</h3>
                                <div class="space-y-1 text-sm">
                                    <div class="flex justify-between">
                                        <span>Property:</span>
                                        <span>${listing.name}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Check-in:</span>
                                        <span>${bookingData.checkIn}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Check-out:</span>
                                        <span>${bookingData.checkOut}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Nights:</span>
                                        <span>${nights}</span>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-green-50 p-4 rounded-lg">
                                <h3 class="font-semibold text-green-900 mb-2">Total Amount</h3>
                                <div class="space-y-1">
                                    <div class="flex justify-between">
                                        <span>USD:</span>
                                        <span class="font-bold">${formatCurrency(totalUSD, 'USD')}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>KES:</span>
                                        <span class="font-bold">${formatCurrency(totalKES, 'KES')}</span>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h3 class="font-semibold text-blue-900 mb-2">Payment Instructions</h3>
                                <p class="text-sm text-blue-800">
                                    Please send the payment to M-PESA Till: <strong>1234</strong>
                                </p>
                                <p class="text-sm text-blue-800 mt-1">
                                    Amount: <strong>${formatCurrency(totalKES, 'KES')}</strong>
                                </p>
                            </div>

                            <form onsubmit="handlePaymentSubmit(event, ${JSON.stringify({listing, bookingData, nights, totalUSD, totalKES}).replace(/"/g, '&quot;')})">
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Transaction ID</label>
                                    <input type="text" name="transactionId" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-rose-500" placeholder="TG4 followed by 7 characters" />
                                </div>

                                <div class="flex space-x-4">
                                    <button type="button" onclick="this.closest('.fixed').remove(); closeModal('booking')" class="flex-1 bg-gray-200 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-300 transition-colors">
                                        Back
                                    </button>
                                    <button type="submit" class="flex-1 bg-green-500 text-white py-2 px-4 rounded-lg hover:bg-green-600 transition-colors">
                                        <span class="confirm-text">Confirm Payment</span>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        };

        window.handlePaymentSubmit = async (event, paymentData) => {
            event.preventDefault();
            const formData = new FormData(event.target);
            const transactionId = formData.get('transactionId');
            
            // Show loading state
            const button = event.target.querySelector('button[type="submit"]');
            const originalText = button.innerHTML;
            button.innerHTML = '<span class="confirm-text">Confirming...</span>';
            button.disabled = true;

            if (!validateTransactionId(transactionId)) {
                button.innerHTML = originalText;
                button.disabled = false;
                showErrorModal('Invalid transaction ID. Please enter a valid ID starting with TG4 followed by 7 characters.');
                return;
            }

            const booking = {
                id: Date.now().toString(),
                userId: AppState.currentUser.id,
                listingId: paymentData.listing.id,
                listingName: paymentData.listing.name,
                location: paymentData.listing.location,
                checkIn: paymentData.bookingData.checkIn,
                checkOut: paymentData.bookingData.checkOut,
                nights: paymentData.nights,
                totalUSD: paymentData.totalUSD,
                totalKES: paymentData.totalKES,
                transactionId,
                status: 'confirmed',
                createdAt: new Date().toISOString()
            };

            const bookings = getStorageItem(StorageKeys.BOOKINGS) || [];
            bookings.push(booking);
            setStorageItem(StorageKeys.BOOKINGS, bookings);
            AppState.bookings = bookings;

            // Send email confirmation
            await sendBookingConfirmation({
                userName: AppState.currentUser.name,
                userEmail: AppState.currentUser.email,
                listingName: paymentData.listing.name,
                checkIn: paymentData.bookingData.checkIn,
                checkOut: paymentData.bookingData.checkOut,
                totalUSD: paymentData.totalUSD,
                totalKES: paymentData.totalKES,
                transactionId
            });

            // Remove payment modal
            event.target.closest('.fixed').remove();
            
            // Show success modal
            showBookingSuccessModal();
        };

        window.showBookingSuccessModal = () => {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center modal-tertiary p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-xl shadow-xl w-full max-w-sm">
                    <div class="p-6 text-center">
                        <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <div class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center">
                                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                            </div>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-900 mb-2">Booking Confirmed!</h2>
                        <p class="text-gray-600 mb-6">
                            Your booking has been confirmed and you will receive a confirmation email shortly.
                        </p>
                        <button onclick="this.closest('.fixed').remove(); closeModal('booking')" class="w-full bg-rose-500 text-white py-2 px-4 rounded-lg hover:bg-rose-600 transition-colors">
                            Done
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        };

        window.showSuccessModal = (message) => {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center modal-tertiary p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-xl shadow-xl w-full max-w-sm">
                    <div class="p-6 text-center">
                        <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <div class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center">
                                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                            </div>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-900 mb-2">Success!</h2>
                        <p class="text-gray-600 mb-6">${message}</p>
                        <button onclick="this.closest('.fixed').remove()" class="w-full bg-rose-500 text-white py-2 px-4 rounded-lg hover:bg-rose-600 transition-colors">
                            Done
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        };

        window.showErrorModal = (message) => {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center modal-tertiary p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-xl shadow-xl w-full max-w-sm">
                    <div class="p-6 text-center">
                        <div class="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <div class="w-12 h-12 bg-red-500 rounded-full flex items-center justify-center">
                                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </div>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-900 mb-2">Error</h2>
                        <p class="text-gray-600 mb-6">${message}</p>
                        <button onclick="this.closest('.fixed').remove()" class="w-full bg-red-500 text-white py-2 px-4 rounded-lg hover:bg-red-600 transition-colors">
                            Close
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        };

        window.handleReviewSubmit = (hostName) => {
            if (!AppState.currentUser) {
                showRestrictedModal(hostName);
                return;
            }

            // Check if user has completed a booking with this host
            const hasCompletedBooking = AppState.bookings.some(booking => 
                booking.userId === AppState.currentUser.id && 
                booking.status === 'completed'
            );

            showRestrictedModal(hostName);
        };

        window.showRestrictedModal = (hostName) => {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center modal-quaternary p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-xl shadow-xl w-full max-w-sm">
                    <div class="p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">Review Restricted</h3>
                            <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600 transition-colors">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                        <p class="text-gray-700 mb-6">
                            Only users who have been hosted by <strong>${hostName}</strong> can leave a review.
                        </p>
                        <button onclick="this.closest('.fixed').remove()" class="w-full bg-rose-500 text-white py-2 px-4 rounded-lg hover:bg-rose-600 transition-colors">
                            Understood
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        };

        // Image carousel functions
        let carouselStates = {};

        window.nextImage = (listingId) => {
            const listing = AppState.filteredListings.find(l => l.id === listingId);
            if (!listing || listing.images.length <= 1) return;
            
            if (!carouselStates[listingId]) carouselStates[listingId] = 0;
            carouselStates[listingId] = (carouselStates[listingId] + 1) % listing.images.length;
            updateCarousel(listingId);
        };

        window.prevImage = (listingId) => {
            const listing = AppState.filteredListings.find(l => l.id === listingId);
            if (!listing || listing.images.length <= 1) return;
            
            if (!carouselStates[listingId]) carouselStates[listingId] = 0;
            carouselStates[listingId] = (carouselStates[listingId] - 1 + listing.images.length) % listing.images.length;
            updateCarousel(listingId);
        };

        window.setImageIndex = (listingId, index) => {
            carouselStates[listingId] = index;
            updateCarousel(listingId);
        };

        const updateCarousel = (listingId) => {
            const carousel = document.getElementById(`carousel-${listingId}`);
            const index = carouselStates[listingId] || 0;
            if (carousel) {
                carousel.style.transform = `translateX(-${index * 100}%)`;
            }
            
            // Update dots
            const dots = carousel?.parentElement.querySelectorAll('.w-2.h-2');
            dots?.forEach((dot, i) => {
                if (i === index) {
                    dot.className = 'w-2 h-2 rounded-full transition-all bg-white';
                } else {
                    dot.className = 'w-2 h-2 rounded-full transition-all bg-white bg-opacity-50';
                }
            });
        };

        // Close dropdowns when clicking outside
        document.addEventListener('click', (event) => {
            const dropdown = document.getElementById('userDropdown');
            const button = event.target.closest('button[onclick="toggleUserDropdown()"]');
            
            if (dropdown && !button && !dropdown.contains(event.target)) {
                dropdown.classList.add('hidden');
            }
        });

        // Initialize EmailJS
        emailjs.init('W0Zng8g6Zol6lMWU9');

        // Initialize app
        initializeStorage();
        loadData();
        render();
    </script>
    <script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('service-worker.js')
        .then(reg => console.log('Service Worker registered', reg))
        .catch(err => console.error('Service Worker registration failed', err));
    });
  }
</script>

</body>
</html>
